<?xml version="1.0" encoding="UTF-8"?>
<configuration scan="true" scanPeriod="30 seconds">
  <!-- aplication.yml에 정의-->
  <springProperty scope="context" name="LOG_LEVEL" source="logging.level.root"/>
  <springProperty scope="context" name="LOG_DIR" source="logging.dir"/>
  <Property name = "LOG_PATTERN" value = "%d{yyyy-MM-dd HH:mm:ss}:%-4relative] %green([%thread]) %highlight(%-5level) %boldWhite([%C.%M:%yellow(%L)]) - %msg%n" />

  <!-- APPENDER (https://logback.qos.ch/manual/appenders.html)
  ConsoleAppender: 콘솔에 로그를 기록
  FileAppender: 파일에 로그를 기록
  RollingFileAppender: 여러 개의 파일을 순회하며 로그를 기록
  SMTPAppender: 로그를 메일로 기록
  DBAppender: 데이터베이스에 로그를 기록
  -->
  <!-- 콘솔 로그 -->
  <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
    <encoder class="ch.qos.logback.classic.encoder.PatternLayoutEncoder">
      <Pattern>
        ${LOG_PATTERN}
      </Pattern>
      <charset>UTF-8</charset>
    </encoder>
  </appender>


  <!-- 파일 로그 -->
  <appender name="FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
    <file>${LOG_DIR}/logs.log</file>
    <encoder class="ch.qos.logback.classic.encoder.PatternLayoutEncoder">
      <Pattern>
        ${LOG_PATTERN}
      </Pattern>
      <charset>UTF-8</charset>
    </encoder>

    <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
      <fileNamePattern>${LOG_DIR}/logs.%d{yyyy-MM-dd}.log</fileNamePattern>
      <maxHistory>30</maxHistory>
      <totalSizeCap>3GB</totalSizeCap>
    </rollingPolicy>
  </appender>


  <!-- 롤링 파일 로그 -->
  <appender name="ROLLINGFILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
    <file>${LOG_DIR}/info/logs.log</file>
    <encoder class="ch.qos.logback.classic.encoder.PatternLayoutEncoder">
      <Pattern>${LOG_PATTERN}</Pattern>
      <charset>UTF-8</charset>
    </encoder>

    <triggeringPolicy
      class="ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy">
      <MaxFileSize>100MB</MaxFileSize>
    </triggeringPolicy>

    <rollingPolicy class="ch.qos.logback.core.rolling.FixedWindowRollingPolicy">
      <FileNamePattern>${LOG_DIR}/playstay/logs/logs.%d{yyyy-MM-dd}.%i.log.zip</FileNamePattern>
      <MinIndex>1</MinIndex>
      <MaxIndex>100</MaxIndex>
    </rollingPolicy>
  </appender>

  <!-- 에러 로그 -->
  <appender name="ERROR" class="ch.qos.logback.core.rolling.RollingFileAppender">
    <filter class="ch.qos.logback.classic.filter.LevelFilter">
      <level>ERROR</level>
      <onMatch>ACCEPT</onMatch>
      <onMismatch>DENY</onMismatch>
    </filter>
    <file>${LOG_DIR}/error/error.log</file>
    <encoder class="ch.qos.logback.classic.encoder.PatternLayoutEncoder">
      <Pattern>
        ${LOG_PATTERN}
      </Pattern>
      <charset>UTF-8</charset>
    </encoder>

    <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
      <fileNamePattern>${LOG_DIR}/playstay/error/error.%d{yyyy-MM-dd}.%i.log</fileNamePattern>
      <maxFileSize>100MB</maxFileSize>
      <maxHistory>30</maxHistory>
      <totalSizeCap>3GB</totalSizeCap>
    </rollingPolicy>
  </appender>


  <!-- 지역적인 로그 설정 -->
  <logger name="org.springframework.web" level="INFO" additivity="false">
    <appender-ref ref="CONSOLE"/>
    <appender-ref ref="FILE"/>
    <appender-ref ref="ERROR"/>
  </logger>

  <logger name="org.apache.ibatis" level="DEBUG" additivity="false">
    <appender-ref ref="CONSOLE"/>
    <appender-ref ref="ROLLINGFILE"/>
    <appender-ref ref="ERROR"/>
  </logger>

  <!-- 전역적인 로그 설정 -->
  <root level="${LOG_LEVEL}">
    <appender-ref ref="CONSOLE"/>
    <appender-ref ref="FILE"/>
    <appender-ref ref="ERROR"/>
  </root>

</configuration>